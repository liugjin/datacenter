<div class="row nav-top"><div class="col s2"><nav>联动规则</nav></div><div class="col s10"><nav><div class="nav-wrapper"><ul class="right"><li><a title="新增" data-target="logic-modal" ng-click="add()" class="btn modal-trigger"><!--i.material-icons.left add-->新增</a></li><!--li--><!--    a.modal-trigger(title="修改",data-target="add-logic", ng-click="modify()", href="",ng-show="selectedLogic")--><!--        i.material-icons.left edit--><!--        | 修改--><!--li--><!--    a.modal-trigger(title="删除", data-target="prompt-modal" ng-click="delete()",ng-show="selectedLogic")--><!--        i.material-icons.left delete--><!--        | 删除--></ul></div></nav></div></div><div><div class="col l12 cool-content"><table class="bordered cool-table"><thead><tr><th class="center">序号</th><th class="center">输入</th><th>运算符<i title="运算符含义：AND-逻辑与，同时满足多个输入条件，执行输出动作; OR-逻辑或，其中一个输入条件满足，执行输出动作" class="material-icons help-cursor tiny">help</i></th><th class="center">输出</th><th></th></tr></thead><tbody><tr ng-repeat="logic in logics" ng-click="select(logic)" ng-class="{&quot;active&quot;: selectedLogic==logic}" class="main"><td class="center">{{$index+1}}</td><td><table><tbody><tr ng-repeat="input in logic.input"><td class="grey-text">输入{{$index+1}}</td><td><div class="title">站点名</div><div class="value">{{items[input.key].stationName}}</div></td><td style="display: inline-block;width:200px"><div class="title">设备名</div><div class="value">{{items[input.key].equipmentName}}</div></td><td ng-if="input.event"><div class="title">告警名</div><div class="value">{{items[input.key].eventName}}</div></td><td ng-if="input.signal"><div class="title">信号名</div><div class="value">{{items[input.key].signalName}}</div></td><td><div class="title">状态</div><div class="value">{{items[input.key].valueName}}</div></td></tr></tbody></table></td><td>{{logic.operator}}</td><td><table><tbody><tr ng-repeat="output in logic.output"><td><div class="title">站点名</div><div class="value">{{items[output.key].stationName}}</div></td><td style="display: inline-block;width:200px"><div class="title">设备名</div><div class="value">{{items[output.key].equipmentName}}</div></td><td><div class="title">控制信号</div><div class="value">{{items[output.key].commandName}}</div></td><td><div class="title">值</div><div class="value">{{items[output.key].valueName}}</div></td></tr></tbody></table></td><td><a href="#logic-modal" ng-click="editLogic(logic, $index)" title="修改" class="waves-effect waves-light modal-trigger"><i class="material-icons">create</i></a><a ng-click="deleteLogic(logic, $index)" title="删除" class="waves-effect"><i class="material-icons">delete</i></a></td></tr></tbody></table></div></div><div id="logic-modal" md-modal="md-modal" style="width:70%" class="modal"><div style="height:64vh" class="modal-content"><h5 class="center">{{index==null?"添加":"修改"}}联动规则</h5><div class="row no-margin"><table style="height: 56vh; overflow:auto; display:block" class="bordered cool-table"><thead><tr style="background-color: rgba(1, 166, 255, 0.2) !important; line-height: 25px !important"><th class="center grey-text"><i ng-click="logic.input.push({station:'',equipment:'',signal:'',value:''})" title="增加信号输入条件" style="cursor:pointer" class="material-icons tiny green-text">add</i><span>输入</span><i ng-click="logic.input.push({station:'',equipment:'',event:'',value:''})" title="增加告警输入条件" style="cursor:pointer" class="material-icons tiny red-text">add</i></th><th title="改变运算符" ng-click="logic.operator=(logic.operator=='AND'?'OR':'AND')" class="center grey-text click-btn">运算符<i style="font-size: 20px" class="material-icons tiny">invert_colors</i></th><th class="center grey-text">输出<i ng-click="logic.output.push({station:'',equipment:'',command:''})" title="增加输出" style="cursor:pointer" class="material-icons tiny">add</i></th></tr></thead><tbody><tr><td><table><tr ng-repeat="input in logic.input"><td style="position:relative"><i ng-if="logic.input.length&gt;1" title="删除输入条件" ng-click="logic.input.splice($index,1)" style="cursor:pointer; position:absolute; left:-10px;top: 50px" class="material-icons tiny close grey-text">remove</i><div class="title">站点名</div><div class="value"><select ng-model="input.station" md-select="md-select" data="stations"><option value="+" ng-selected="input.station == null || input.station == '+'">所有站点</option><option ng-repeat="station in stations" value="{{station.model.station}}" ng-selected="input.station == station.model.station">{{station.model.name}}</option></select></div></td><td><div class="title">设备名</div><div class="value"><select ng-model="input.equipment" md-select="md-select" data="stas[input.station].equipments.items" ng-change="selectEquipment(input.station, input.equipment)"><option value="+" ng-selected="input.equipment == null || input.equipment == '+'">所有设备</option><option ng-repeat="equipment in stas[input.station].equipments.items" value="{{equipment.model.equipment}}" ng-selected="input.equipment == equipment.model.equipment">{{equipment.model.name}}</option></select></div></td><td ng-if="input.hasOwnProperty('event')"><div class="title">告警名</div><div class="value"><select ng-model="input.event" md-select="md-select" data="equips[input.station+&quot;.&quot;+input.equipment].events.items.length"><option value="+" ng-selected="input.event == null || input.event == '+'">所有告警</option><option ng-repeat="event in equips[input.station+&quot;.&quot;+input.equipment].events.items" value="{{event.model.event}}" ng-selected="input.event == event.model.event">{{event.model.name}}</option></select></div></td><td ng-if="input.hasOwnProperty('event')"><div class="title">状态</div><div class="value"><select ng-model="input.value" md-select="md-select" data="project.dictionary.eventphases.items.length"><option value="+" ng-selected="input.value == null || input.value == '+'">所有状态</option><option ng-repeat="state in project.dictionary.eventphases.items" value="{{state.model.phase}}" ng-selected="input.value == state.model.phase">{{state.model.name}}</option></select></div></td><td ng-if="input.hasOwnProperty('signal')"><div class="title">信号名</div><div class="value"><select ng-model="input.signal" md-select="md-select" data="equips[input.station+&quot;.&quot;+input.equipment].signals.items.length" ng-change="selectSignal(input.station, input.equipment, input.signal)"><option ng-repeat="signal in equips[input.station+&quot;.&quot;+input.equipment].signals.items | filter:filterEnumSignal()" value="{{signal.model.signal}}" ng-selected="input.signal == signal.model.signal">{{signal.model.name}}</option></select></div></td><td ng-if="input.hasOwnProperty('signal')"><div class="title">状态</div><div class="value"><select ng-model="input.value" md-select="md-select" data="sigs[input.station+&quot;.&quot;+input.equipment+&quot;.&quot;+input.signal].enums"><option ng-repeat="value in sigs[input.station+&quot;.&quot;+input.equipment+&quot;.&quot;+input.signal].enums" value="{{value.id}}" ng-selected="input.value == value.id">{{value.name}}</option></select></div></td></tr></table></td><td><table><tr><td><div class="center">{{logic.operator}}</div></td></tr></table><!--select(ng-model='input.operator', md-select, style="width: 50%")//    option(value="AND" ng-selected = "input.operator == 'AND'") AND
//    option(value="OR" ng-selected = "input.operator == 'OR'") OR--></td><td><table><tr ng-repeat="output in logic.output"><td style="position:relative"><i ng-if="logic.output.length&gt;1" title="删除输出动作" ng-click="logic.output.splice($index,1)" style="cursor:pointer; position:absolute; left:-10px;top: 50px" class="material-icons tiny close grey-text">remove</i><div class="title">站点名</div><div class="value"><select ng-model="output.station" md-select="md-select" data="stations"><!--option(value="+" ng-selected = "output.station == null || output.station == '+'") 所有站点--><option ng-repeat="station in stations" value="{{station.model.station}}" ng-selected="output.station == station.model.station">{{station.model.name}}</option></select></div></td><td><div class="title">设备名</div><div class="value"><select ng-model="output.equipment" md-select="md-select" data="stas[output.station].equipments.items" ng-change="selectEquipment(output.station, output.equipment)"><!--option(value="+" ng-selected = "output.equipment == null || output.equipment == '+'") 所有设备--><option ng-repeat="equipment in stas[output.station].equipments.items" value="{{equipment.model.equipment}}" ng-selected="output.equipment == equipment.model.equipment">{{equipment.model.name}}</option></select></div></td><td><div class="title">控制信号</div><div class="value"><select ng-model="output.command" md-select="md-select" data="equips[output.station+&quot;.&quot;+output.equipment].commands.items.length" ng-change="selectCommand(output.station, output.equipment, output.command)"><!--option(value="+" ng-selected = "output.command == null || output.command == '+'") 所有控制--><option ng-repeat="command in equips[output.station+&quot;.&quot;+output.equipment].commands.items" value="{{command.model.command}}" ng-selected="output.command == command.model.command">{{command.model.name}}</option></select></div></td><td><div class="title">值</div><div class="value"><input type="text" ng-model="output.value" ng-if="cmds[output.station+&quot;.&quot;+output.equipment+&quot;.&quot;+output.command].type != &quot;enum&quot;" ng-change="output.valueType=cmds[output.station+&quot;.&quot;+output.equipment+&quot;.&quot;+output.command].type"/><select ng-model="output.value" md-select="md-select" data="cmds[output.station+&quot;.&quot;+output.equipment+&quot;.&quot;+output.command].enums" ng-if="cmds[output.station+&quot;.&quot;+output.equipment+&quot;.&quot;+output.command].type == &quot;enum&quot;" ng-change="output.valueType=cmds[output.station+&quot;.&quot;+output.equipment+&quot;.&quot;+output.command].type"><option ng-repeat="value in cmds[output.station+&quot;.&quot;+output.equipment+&quot;.&quot;+output.command].enums" value="{{value.id}}" ng-selected="output.value == value.id">{{value.name}}</option></select></div></td></tr></table></td></tr></tbody></table></div></div><div class="modal-footer"><div ng-click="saveLogic()" class="modal-confirm modal-action right"><i class="material-icons">done</i><span>确认</span></div><div class="modal-cancel modal-action right modal-close"><i class="material-icons">close</i><span>取消</span></div></div></div>